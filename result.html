<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Interview Feedback Report</title>

  <!-- Include Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f7fa;
      color: #1a1a1a;
      margin: 0;
      padding: 40px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      padding: 40px 50px;
    }

    h1 {
      text-align: center;
      color: #0d3b66;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    h3 {
      color: #144552;
      border-bottom: 2px solid #d1e8f0;
      padding-bottom: 5px;
      margin-top: 25px;
    }

    .section {
      background: #f8fbfc;
      padding: 20px;
      border-left: 5px solid #0d3b66;
      border-radius: 10px;
      margin-top: 15px;
      white-space: pre-wrap;
      line-height: 1.6;
    }

    .back-btn {
      display: block;
      text-align: center;
      margin-top: 40px;
      background: #0d3b66;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 10px;
      text-decoration: none;
      font-size: 1rem;
      transition: 0.3s;
    }

    .back-btn:hover {
      background: #062a44;
    }

    .emotion-item {
      margin-bottom: 10px;
      padding: 10px;
      background: #eef5f6;
      border-radius: 8px;
    }

    .emotion-item strong {
      color: #0d3b66;
    }

    canvas {
      margin-top: 20px;
      width: 100%;
      height: 300px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìä AI Interview Feedback Report</h1>

    <h3>üéß Emotion Analysis</h3>
    <div id="emotion-container" class="section">Loading emotion data...</div>

    <!-- Chart container -->
    <canvas id="emotionChart"></canvas>

    <h3>üìù Final AI Feedback</h3>
    <div id="final-feedback" class="section">Loading final feedback...</div>

    <a href="/" class="back-btn">üè† Back to Home</a>
  </div>

  <script>
    // Retrieve feedback and answers
    const feedback = sessionStorage.getItem("final_feedback") || "No feedback available.";
    const answersData = JSON.parse(sessionStorage.getItem("answers") || "[]");

    document.getElementById("final-feedback").innerText = feedback;

    const emotionContainer = document.getElementById("emotion-container");

    if (answersData.length === 0) {
      emotionContainer.innerText = "No emotion data available.";
    } else {
      emotionContainer.innerHTML = answersData
        .map(a => `<div class="emotion-item"><strong>Question ${a.question}:</strong> ${a.description}</div>`)
        .join("");
    }

    // ========== Chart.js Visualization ==========
    const ctx = document.getElementById("emotionChart");
    if (answersData.length > 0 && ctx) {
      const emotionCounts = {};
      answersData.forEach(a => {
        emotionCounts[a.emotion] = (emotionCounts[a.emotion] || 0) + 1;
      });

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(emotionCounts),
          datasets: [{
            label: 'Emotion Frequency',
            data: Object.values(emotionCounts),
            backgroundColor: ['#4CAF50', '#FF9800', '#2196F3', '#9C27B0'],
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: {
              display: true,
              text: 'Emotional Trends Across Interview',
              color: '#0d3b66',
              font: { size: 18, weight: 'bold' }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Count' }
            },
            x: {
              title: { display: true, text: 'Emotion Type' }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
