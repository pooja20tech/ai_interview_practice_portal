<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Interview</title>
<style>
body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg,#f0f4f8,#d9e2ec); display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
.container { background:#fff; border-radius:15px; padding:30px 40px; box-shadow:0 8px 30px rgba(0,0,0,0.1); text-align:center; max-width:600px; }
button { background:#0d3b66; color:white; border:none; padding:10px 20px; margin:10px; border-radius:8px; cursor:pointer; font-size:1rem; transition:0.3s; }
button:hover { background:#062a44; }
audio { margin-top:15px; }
</style>
</head>
<body>
<div class="container">
  <h2 id="question">{{ question }}</h2>

  <div>
    <button id="record-btn">üéô Start Recording</button>
  </div>

  <audio id="audio-playback" controls></audio>

  <div>
    <button id="next-btn" disabled>‚û°Ô∏è Next Question</button>
  </div>
</div>

<script>
let audioBlob = null;
let mediaRecorder, chunks = [];
const recordBtn = document.getElementById("record-btn");
const nextBtn = document.getElementById("next-btn");
const audioPlayer = document.getElementById("audio-playback");

// ===== RECORD AUDIO =====
recordBtn.onclick = async () => {
  if (!mediaRecorder) {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.ondataavailable = e => chunks.push(e.data);
    mediaRecorder.onstop = () => {
      audioBlob = new Blob(chunks, { type: "audio/wav" });
      audioPlayer.src = URL.createObjectURL(audioBlob);
      chunks = [];
      nextBtn.disabled = false;
    };
  }

  if (mediaRecorder.state === "inactive") {
    mediaRecorder.start();
    recordBtn.innerText = "‚èπ Stop Recording";
  } else {
    mediaRecorder.stop();
    recordBtn.innerText = "üéô Start Recording";
  }
};

// ===== NEXT QUESTION =====
nextBtn.onclick = async () => {
  nextBtn.disabled = true;
  const fd = new FormData();
  if (audioBlob) fd.append("audio_data", audioBlob, "answer.wav");

  const res = await fetch("/next_question", { method: "POST", body: fd });
  const data = await res.json();

  if (data.done) {
    window.location.href = "/result"; // go to result page
    return;
  }

  document.getElementById("question").innerText = data.question;
  audioBlob = null;
  audioPlayer.src = "";
};
</script>
</body>
</html>
